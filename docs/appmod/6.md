# **JMS messaging integration**</br>*Application Modernization - WebSphere to Liberty*

!!! quote "TERMINOLOGY"
    For readability, <a href="https://www.ibm.com/products/websphere-application-server" target="_blank">**IBM WebSphere Application Server**</a> (WAS) in this chapter is referred to in shorthand as "WebSphere", unless noted otherwise. Similarly, <a href="https://www.ibm.com/products/cloud-pak-for-applications/liberty" target="_blank">**IBM WebSphere Liberty**</a> is referenced in shorthand as simply "Liberty".
    
## **i. Incentives to modernize**

**WebSphere** traditionally connects Java Enterprise Edition (Java EE) applications to **IBM MQ** using complex **Java Message Service** (**JMS**) configurations which depend upon external XML files. JMS is the standard by which Java APIs send, receive, and manage asynchronous messages between distributed Java EE applications. In turn, IBM MQ provides a middleware layer to ensure that such asynchronous messaging is delivered *reliably* between said applications. Collectively, these components come together to form the **WebSphere MQ JMS integration** that Lariat Corporation is using in their legacy systems today.

**Liberty** still makes use of JMS and MQ, but replaces the use of external XML file configuration management in favor of declarative configurations *directly within* Liberty's `server.xml` resource. The result is that configuration is no longer defined external to the server, which in turn reduces the complexity of managing such configurations for Lariat's developers and improves the maintainability of the messaging integrations.

</br>

| Feature | WebSphere MQ JMS Integration | Liberty JMS Configuration |
| - | - | - |
| **Complexity** | High complexity owing to verbose XML or admin console requirements. | Significantly simplified and concise. |
| **Maintainability** | Difficult, configuration is dispersed and complex. | Easy to maintain, with all resources clearly defined in one place. |
| **Productivity** | Lower developer productivity due to manual configuration and overhead. | Improved developer productivity due to straightforward and rapid setup. |
| **Integrations** | Cloud and microservices are harder to scale or adapt. | Cloud and microservices are easily adapted due to cloud-native design. |

By modernizing Lariat's WebSphere-based approach of MQ JMS integration to Liberty's declarative JMS-based configuration, the expectation is that the company's management of asynchronous message delivery between applications can be more easily maintained and better aligned to cloud-native best practices.

---

## **ii. WebSphere legacy code**

First, examine the legacy code (below), which as mentioned previously is a snapshot of a larger application using **WebSphere's MQ JMS integration**:

=== "WEBSPHERE APPLICATION SERVER"

    ``` xml linenums="1"
    <!-- ejb-jar.xml -->
    <message-driven>
        <ejb-name>LegacyMDB</ejb-name>
        <ejb-class>com.lariat.messaging.LegacyMDB</ejb-class>
        <transaction-type>Container</transaction-type>
        <message-driven-destination>
            <destination-type>javax.jms.Queue</destination-type>
        </message-driven-destination>
    </message-driven>

    <!-- ibm-ejb-jar-bnd.xml -->
    <message-driven name="LegacyMDB">
        <activation-config>
            <activation-config-property>
                <activation-config-property-name>destination</activation-config-property-name>
                <activation-config-property-value>jms/legacyQueue</activation-config-property-value>
            </activation-config-property>
        </activation-config>
    </message-driven>
    ```

Lariat's particular implementation of WebSphere MQ JMS utilizes XML descriptors (`ejb-jar.xml`, `ibm-ejb-jar-bnd.xml` on **lines 1 and 11**, respectively) to define message-driven beans (MDB) and their JMS destinations.

This is the *explicit* and *manual* style of configuring messaging endpoints through separate descriptor (XML) files â€” a sharp contrast to the declarative approach we will examine with Liberty momentarily. WebSphere's approach of using separate descriptor files makes setup of new configurations potentially more complex and prone to human-induced errors in the code.

---

## **iii. Liberty modernized code**

Consider below the modernized (but functionally equivalent) application code using **Liberty's JMS configuration**:

=== "WEBSPHERE LIBERTY"

    ``` xml linenums="1"
    <!-- server.xml -->
    <server>
        <featureManager>
            <feature>jms-2.0</feature>
        </featureManager>

        <jmsQueue id="modernQueue" jndiName="jms/modernQueue" />

        <messageDrivenBean id="ModernMDB">
            <activationSpec>
                <activationSpecClass>javax.jms.Queue</activationSpecClass>
                <activationSpecProperty name="destination">jms/modernQueue</activationSpecProperty>
            </activationSpec>
            <className>com.lariat.messaging.ModernMDB</className>
        </messageDrivenBean>
    </server>
    ```

=== "WEBSPHERE APPLICATION SERVER"

    ``` xml linenums="1"
    <!-- ejb-jar.xml -->
    <message-driven>
        <ejb-name>LegacyMDB</ejb-name>
        <ejb-class>com.lariat.messaging.LegacyMDB</ejb-class>
        <transaction-type>Container</transaction-type>
        <message-driven-destination>
            <destination-type>javax.jms.Queue</destination-type>
        </message-driven-destination>
    </message-driven>

    <!-- ibm-ejb-jar-bnd.xml -->
    <message-driven name="LegacyMDB">
        <activation-config>
            <activation-config-property>
                <activation-config-property-name>destination</activation-config-property-name>
                <activation-config-property-value>jms/legacyQueue</activation-config-property-value>
            </activation-config-property>
        </activation-config>
    </message-driven>
    ```

Through the process of modernizing the code, Lariat switched to Liberty's messaging providers using standardized JMS APIs in a single, unified `server.xml` configuration. All JMS resources, such as queues and MDBs, are defined directly within the `server.xml` configuration file.

The net result is that configurations are simplified compared to the traditional WebSphere approach of separate descriptor files. Clearly named and easily identifiable JMS queues (**line 1**), as well as activation specifications (beginning on **line 3**), are consolidated within the streamlined `server.xml` configuration.

In summary, consolidation of Lariat's messaging configurations into a simplified and centralized pattern has streamlined future maintenance of these configuration files and simplified the process of troubleshooting messaging integrations for their developers.

---

## **iv. Hands-on with WCA**



---

## **v. Next steps**


