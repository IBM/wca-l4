# **Configuration and dependency management**</br>*Application Modernization - WebSphere to Liberty*

!!! quote "TERMINOLOGY"
    For readability, <a href="https://www.ibm.com/products/websphere-application-server" target="_blank">**IBM WebSphere Application Server**</a> (WAS) in this chapter is referred to in shorthand as "WebSphere", unless noted otherwise. Similarly, <a href="https://www.ibm.com/products/cloud-pak-for-applications/liberty" target="_blank">**IBM WebSphere Liberty**</a> is referenced in shorthand as simply "Liberty".
    
## **i. Incentives to modernize**

In order to perform configuration and dependency management, Lariat Corporation employs various WebSphere **class loader configurations** to exert control over how Java classes and libraries are accessed by applications. In essence, these class loaders help define the scope and visibility of Java classes, resources, and libraries that are available for use by those applications.

Legacy applications built for WAS can use class loader configurations in a variety of ways, including:

- **Isolation of application dependencies:** provide assurances that applications avoid conflicts or unintended interactions that might arise from using shared libraries
- **Application module management:** for WebSphere Enterprise Archive (EAR) applications, like those covered in the previous section, class loader configurations can manage the visibility of classes across different modules of the same EAR file

In addition, the ability to selectively control class loading can reduce the overall memory footprint and resource overhead of an application. The result is that class loader configurations play an important part for managing dependency conflicts and application stability across Lariat's WAS services and environments.

However, Lariat's **legacy WAS** implementation suffers from significant (and unnecessary) complexity owing to bloated class-loader configurations. Multiple, shared libraries need to be configured and adjusted via an admin console, resulting in redundant use of dependencies and libraries that could otherwise be shared with better design. Through modernization of the code to **Liberty**, the expectation is that process of managing dependencies and application configuration can be simplified and more easily maintained.

---

## **ii. WebSphere legacy code**

First, examine the legacy code (below), which as mentioned previously is a snapshot of a larger WebSphere class loader configuration.

=== "WEBSPHERE APPLICATION SERVER"

    ```xml linenums="1"
    <!-- deployment.xml -->
    <deployment>
        <classloader mode="PARENT_LAST">
            <library>
                <file path="/shared/libs/customlib.jar" />
            </library>
            <shared-library name="LegacySharedLib" />
        </classloader>
    </deployment>

    <!-- shared-libraries.xml -->
    <shared-libraries>
        <library name="LegacySharedLib">
            <files>
                <file>/opt/was/shared/lib/shared-legacy.jar</file>
            </files>
        </library>
    </shared-libraries>
    ```

</br>
The legacy implementation utilizes separate, detailed descriptor files like `deployment.xml` (lines 1-9) and `shared-libraries.xml` (lines 11-18) to handle complex dependency and class-loading configurations. Lariat administrators who manage this code base must *explicitly* set class loader modes to control resource loading order â€” an inefficient, manual process achieved using the `PARENT_LAST` option.

As a consequence, libraries that should ideally be shared by multiple applications instead need to be managed separate by each application in turn. This is terribly inefficient and produces needlessly complex classloader configurations. For Lariat's administrators, this approach to configuration and dependency management has frequently resulted in version conflicts for applications and complex debugging work for developers.

---

## **iii. Liberty modernized code**

Consider below the modernized (but functionally equivalent) application code with Liberty:

=== "WEBSPHERE LIBERTY"

    ``` xml linenums="1" hl_lines="1"
    <!-- server.xml -->
    <server>
        <featureManager>
            <feature>webProfile-8.0</feature>
        </featureManager>

        <library id="customLib">
            <fileset dir="${server.config.dir}/shared/libs" includes="*.jar" />
        </library>

        <application location="modernized.war">
            <classloader delegation="parentLast">
                <commonLibrary>
                    <library ref="customLib" />
                </commonLibrary>
            </classloader>
        </application>
    </server>
    ```

=== "WEBSPHERE APPLICATION SERVER"

    ```xml linenums="1" hl_lines="1 11"
    <!-- deployment.xml -->
    <deployment>
        <classloader mode="PARENT_LAST">
            <library>
                <file path="/shared/libs/customlib.jar" />
            </library>
            <shared-library name="LegacySharedLib" />
        </classloader>
    </deployment>

    <!-- shared-libraries.xml -->
    <shared-libraries>
        <library name="LegacySharedLib">
            <files>
                <file>/opt/was/shared/lib/shared-legacy.jar</file>
            </files>
        </library>
    </shared-libraries>
    ```

</br>
The modernized Liberty code implementation simplifies the management of dependencies by removing the discrete (separate) descriptors like `deployment.xml` and `shared-libraries.xml` from the WAS implementation. Instead, configuration and depedency management has been consolidated into a single `server.xml` descriptor, which more clearly defines the permitted libraries and their associated paths.

Other benefits from the modernization work also include:

- Class loading policies (such as 'parentLast' on line 12) are now explicitly stated, helping to simplify the process of resource management for developers drawing from these resources.

    ``` xml
    <classloader delegation="parentLast">
        <commonLibrary>
            <library ref="customLib" />
        </commonLibrary>
    </classloader>
    ```

- Dependencies are now directly tied and associated to applications, creating relationships between the two that are more transparent and easier to maintain.

Ultimately, the modernization process into Liberty has resulted in configuration and dependency management that reduces dependency conflicts, simplifies resource management, and improves the overall clarity and maintainability of these assets going forward.

---

## **iv. Hands-on with WCA**



---

## **v. Next steps**


